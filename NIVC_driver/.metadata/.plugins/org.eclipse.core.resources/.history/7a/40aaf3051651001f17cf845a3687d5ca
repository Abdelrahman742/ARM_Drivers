/*
 * SysTick.c
 *
 *  Created on: Jul 30, 2024
 *      Author: Abdelrahman Ibrahem Adel
 * Description: .c file in Systick driver
 */
#include "SysTick.h"
#include "tm4c123gh6pm_registers.h"

static volatile void (*g_callBackPtr)(void) = NULL_PTR;

void SysTick_Init(uint16 a_TimeInMilliSeconds)
{
    SYSTICK_CTRL_REG = 0;
    SYSTICK_RELOAD_REG = ((16000*a_TimeInMilliSeconds)-1);
    SYSTICK_CURRENT_REG = 0;
    SYSTICK_CTRL_REG   |= 0x07;
    /* Assign priority level 0 to the SysTick Interrupt */
    NVIC_SYSTEM_PRI3_REG =  (NVIC_SYSTEM_PRI3_REG & SYSTICK_PRIORITY_MASK) | (SYSTICK_INTERRUPT_PRIORITY << SYSTICK_PRIORITY_BITS_POS);
}
void SysTick_StartBusyWait(uint16 a_TimeInMilliSeconds)
{
    SYSTICK_CTRL_REG = 0;
    SYSTICK_RELOAD_REG = ((16000*a_TimeInMilliSeconds)-1);
    SYSTICK_CURRENT_REG = 0;
    SYSTICK_CTRL_REG   |= 0x05;
    while(!(SYSTICK_CTRL_REG & (1<<16)));
}
void SysTick_Handler(void)
{
    if(g_callBackPtr != NULL_PTR)
    {
        (*g_callBackPtr)();
    }
}
void SysTick_SetCallBack(volatile void (*Ptr2Func) (void))
{
    g_callBackPtr=Ptr2Func;
}
void SysTick_Stop(void)
{
    SYSTICK_CTRL_REG &=~(1<<0);
}
void SysTick_Start(void)
{
    SYSTICK_CTRL_REG |=(1<<0);
}
void SysTick_DeInit(void)
{
    SYSTICK_CTRL_REG = 0;
    SYSTICK_RELOAD_REG = 0;
    SYSTICK_CURRENT_REG = 0;
    g_callBackPtr = NULL_PTR;
}
